/*!
 * Start Bootstrap - SB Admin 2 v4.0.7 (https://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

!function(t){"use strict";t("#sidebarToggle, #sidebarToggleTop").on("click",function(o){t("body").toggleClass("sidebar-toggled"),t(".sidebar").toggleClass("toggled"),t(".sidebar").hasClass("toggled")&&t(".sidebar .collapse").collapse("hide")}),t(window).resize(function(){t(window).width()<768&&t(".sidebar .collapse").collapse("hide")}),t("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(o){if(768<t(window).width()){var e=o.originalEvent,l=e.wheelDelta||-e.detail;this.scrollTop+=30*(l<0?1:-1),o.preventDefault()}}),t(document).on("scroll",function(){100<t(this).scrollTop()?t(".scroll-to-top").fadeIn():t(".scroll-to-top").fadeOut()})}(jQuery);

//ELIMINAR DATOS AL CERRAR EL MODAL ESTADOS Y COMENTARIOS
$('.estado').on('hidden.bs.modal', function (e) {
    $('#delegado').html('');
    $('#pago').html('');
    $('#textareacomment').html('');
    $('.exito').Attr('hidden');
    $('#exito').html('');

    $('#ver_comentario').html('');
});

//ELIMINAR DATOS MODAL EDIT
$('.edit').on('hidden.bs.modal', function (e) {
    $('#nomina_id').val('');
    $('#inputSueldo').val(''); 
    $('.exitoEdit').hide();
    $('#exitoEdit').html('');
    $('#name').html('');
});

//ELIMINAR DATOS MODAL VER
$('.ver').on('hidden.bs.modal', function (e) {
    $('#ver_nombre').html('');
    $('#ver_sueldo').html('');
    $('#ver_fecha').html('');
    $('#ver_comentario').html('');
});

//**MODAL DATOS ESTADO Y COMENTARIO VOTOS
function stateycomment(data){
    var id=data;
    var route=$('#route'+id).attr('direccionamiento');
    $.ajax({
    url:route,
    type:'GET',
    data:{},
    success: function(response){
        console.log(response);
    $('#textareacomment').val(response.observaciones);
    $('#state'+response.estado).attr("selected", "selected");
    $('#endvoters_id').val(id);
            }
  //$.get(route,function(info){

  // });
});
}

//AGREGAR ESTADO UPDATE VOSTOS/ESTADOS
$('#actualizar').click(function(){
   var id=$('#endvoters_id').val(); 
   var state=$('#selectstate').val();
   var comment=$('#textareacomment').val();
   var route=$('#actualizar').attr('ruta')+'/'+id;
   var token=$('input[name="_token"]').val();
    $.ajax({  
    url:route,
    headers:{'X-CSRF-TOKEN':token},
    type:'PUT',
    dataType:'json',
    data:{state:state,comment:comment,id:id},
   success:function(response){
        
        $('#selectstate').removeClass('is-valid').addClass('is-valid');
        $('#textareacomment').removeClass('is-valid').addClass('is-valid');
    if(response.estado==1){
        var clase=$('.tr'+response.id).attr('class');
        $('.tr'+response.id).removeClass(clase).addClass("table-success tr"+response.id);

    }
    if(response.estado==2){
        var clase=$('.tr'+response.id).attr('class');
        $('.tr'+response.id).removeClass(clase).addClass("table-warning tr"+response.id);
    }
    if(response.estado==3){
        var clase=$('.tr'+response.id).attr('class');
        $('.tr'+response.id).removeClass(clase).addClass("table-danger tr"+response.id);
    }
    
    $('#textareacomment').val(response.observaciones);
    $('.exito').removeAttr('hidden');
    $('#exito').html('Se ha actualizado correctamente.');
    },
    error: function(error){
        console.log(error.responseJSON.errors.comentario);
        if(error.responseJSON.errors.comentario){
            $('#textareacomment').addClass('is-invalid');
           $('#mensajes').show().html(error.responseJSON.errors.comentario);
           }
        if(error.responseJSON.errors.state){
            $('#selectstate').addClass('is-invalid');
        $('#state').show().html(error.responseJSON.errors.state);
        }
    }

    });
});

//AGREGAR COMENTARIO SHOW VOTANTES
$('#comentar').click(function(){
   var id=$('#endvoters_id').val(); 
   var state=$('#selectstate').val();
   var comment=$('#textareacomment').val();
   var route=$('#comentar').attr('ruta')+'/'+id;
   var token=$('input[name="_token"]').val();
    $.ajax({  
    url:route,
    headers:{'X-CSRF-TOKEN':token},
    type:'PUT',
    dataType:'json',
    data:{state:state,comment:comment,id:id},
   success:function(response){
       $('#commen').html(response.observaciones);
       $('#selectstate').removeClass('is-valid').addClass('is-valid');
       $('#textareacomment').removeClass('is-valid').addClass('is-valid');
       $('.state').html('<b>Estado: </b>'+response.estado);
       $('.exito').removeAttr('hidden');
       $('#exito').html('Se ha actualizado correctamente.');
    }

    });
});

//DATOS ELIMINAR VOTANTE
function eliminar(data){
    var id=data;
    var route=$('#route'+id).attr('direccionamiento');
    $.ajax({
    url:route,
    type:'GET',
    data:{},
    success: function(response){
    $('#name').html(response.nombre);
    $('#endvoters_id').val(id);
    //DATOS FORM DELETE
    var ruta=$('#id_vote').attr('ruta');
    $('#id_vote').attr('action',ruta+id);
    //FIN DATOS FORM DELETE
    
    }
  //$.get(route,function(info){

  // });
});
}

//**MODAL NOMINA DATOS
function DatosNomina(data){
    var id=data;
    var route=$('#route'+id).attr('direccionamiento');
    $.ajax({
    url:route,
    type:'GET',
    data:{},      
    success: function(response){
    $('#pago').html(response.nomina.sueldo);
    $('#delegado').html(response.delegado.name);
    $('#nomina_id').val(response.nomina.id);
    $('.sueldo').val(response.nomina.sueldo);
    }
});
}

//**MODAL NOMINA ELIMINAR
$('#eliminar').click(function(){
   var id=$('#nomina_id').val(); 
   var sueldo=$('.sueldo').val(); 
   var eliminar=0;
   var route=$('#eliminar').attr('ruta')+'/'+id;
   var token=$('input[name="_token"]').val();
    console.log(route);
    $.ajax({  
    url:route,
    headers:{'X-CSRF-TOKEN':token},
    type:'PUT',
    dataType:'json',
    data:{sueldo:sueldo,eliminar:eliminar},
   success:function(response){
       console.log(response);
       $('.exito').removeAttr('hidden');
       $('#exito').html('Se ha eliminado el pago correctamente.');
       $('#row'+id).remove();
    }

    });
});

//**MODAL NOMINA DATOS EDITAR
function EditNomina(data){
    var id=data;
    var route=$('#edit'+id).attr('direccionamiento');
    $.ajax({
    url:route,
    type:'GET',
    data:{},    
    success: function(response){
    console.log(response);
    $('#inputSueldo').val(response.nomina.sueldo);
    $('#name').html(response.delegado.name);
    $('#nomina_id').val(response.nomina.id);
    }
});
}

//**MODAL NOMINA EDITAR
$('#editar').click(function(){
   var id=$('#nomina_id').val(); 
   var sueldo=$('#inputSueldo').val(); 
   var eliminar=1;
   var route=$('#editar').attr('ruta')+'/'+id;
   var token=$('input[name="_token"]').val();
    $.ajax({  
    url:route,
    headers:{'X-CSRF-TOKEN':token},
    type:'PUT',
    dataType:'json',
    data:{eliminar:eliminar,sueldo:sueldo},
   success:function(response){
       console.log(response);
       $('#sueldo'+id).html(response.nomina.sueldo);
       $('.exitoEdit').show();
       $('#exitoEdit').html('Se ha editado el pago correctamente.');
    }

    });
});

//**MODAL NOMINA DATOS
function verNomina(data){
    var id=data;
    var route=$('#ver'+id).attr('direccionamiento');
    $.ajax({
    url:route,
    type:'GET',
    data:{},      
    success: function(response){
    $('#ver_sueldo').html(response.nomina.sueldo);
    $('#ver_nombre').html(response.delegado.name);
    $('#ver_fecha').html(response.nomina.created_at);
    $('#ver_comentario').html(response.nomina.observaciones);
    }
});
}

//BUSCAR VOTANTES AJAX
    $('#search').keyup(function(e){
        e.preventDefault();
        var token=$('input[name="_token"]').val();
        var route=$('#search').attr('direccionamiento');
       // var key=$('#search').val();
        var word=$(this).val();       
        console.log(word);
        $.ajax({
            url:route,
            headers:{'X-CSRF-TOKEN':token},
            type:'POST',
            data:{word:word},
            
            success: function(response){
                if(response.coincidencias>0){
                $('#row').html('');
                var rows=response.votantes.data;
                var row=response.coincidencias;
                $('#coin').remove();
                for (  i = 0 ; i < row; i++){
			var nuevafila= "<tr><td>" +
			rows[i].nombre + "</td><td>" +
			rows[i].cedula + "</td><td>" +
			rows[i].sexo + "</td><td>" +
			rows[i].colegio_id + "</td><td>" +
			rows[i].trabajo + "</td><td>"+
            rows[i].estudia + "</td><td>" +
			rows[i].ciudad + "</td></tr>"
 
			$("#row").append(nuevafila);
		}
                $('#coincidencias').html("Coincidencias "+response.coincidencias);
                }else{
                    $('#row').html('<h2 class="text-danger mx-auto" id="coin">No se encontraron coincidencias.</h2>');
                    $('#coincidencias').html("Coincidencias "+0);
                }
               
    },
            error: function(error){
               
            }
        });
        
    });

//BUSCAR Nominas AJAX
    $('.sea').keyup(function(e){
        e.preventDefault();
        var token=$('input[name="_token"]').val();
        var route=$('.sea').attr('direccionamiento');
       // var key=$('#search').val();
        var word=$(this).val(); 
        console.log(word);
        $.ajax({
            url:route,
            headers:{'X-CSRF-TOKEN':token},
            type:'POST',
            data:{word:word},
            
            success: function(response){
                console.log(response.nominas);
                if(response.coincidencias>0){
                $('#row').html('');
                var rows=response.nominas;
                var delegado=response.delegado;
                var row=response.coincidencias;
                $('#coin').remove();
                for (  i = 0 ; i < row; i++){
			var nuevafila= "<tr><td>" +
			delegado.name + "</td><td>" +
			rows.sueldo + "</td><td>" +
			rows.created_at + "</td><td>" +
			rows.observaciones+ "</td></tr>"
 
			$("#row").append(nuevafila);
		}
                $('#coincidencias').html("Coincidencias "+response.coincidencias);
                }else{
                    $('#row').html('<h2 class="text-danger mx-auto" id="coin">No se encontraron coincidencias.</h2>');
                    $('#coincidencias').html("Coincidencias "+0);
                }
               
    },
            error: function(error){
               console.log(error);
            }
        });
        
    });